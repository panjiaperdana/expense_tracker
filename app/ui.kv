#:import dp kivy.metrics.dp

<ExpenseRow@BoxLayout>:
    size_hint_y: None
    height: dp(36)
    spacing: dp(5)
    exp_id: ""
    date: ""
    category: ""
    amount: ""
    note: ""
    Label:
        text: root.exp_id
        size_hint_x: 0.1
    Label:
        text: root.date
        size_hint_x: 0.2
    Label:
        text: root.category
        size_hint_x: 0.2
    Label:
        text: root.amount
        size_hint_x: 0.2
    Label:
        text: root.note
        size_hint_x: 0.2
    BoxLayout:
        size_hint_x: 0.1
        spacing: dp(5)
        Button:
            text: "Edit"
            on_release: app.root.open_edit_dialog(root.exp_id)
        Button:
            text: "Del"
            on_release: app.root.on_delete(root.exp_id)

<MainScreen>:
    canvas.before:
        Color:
            rgba: 0.1, 0.1, 0.1, 1  # dark gray
        Rectangle:
            pos: self.pos
            size: self.size

    orientation: 'vertical'
    padding: dp(10)
    spacing: dp(8)

    # Add expense row
    BoxLayout:
        size_hint_y: None
        height: dp(44)
        spacing: dp(10)
        Button:
            text: "Pick Date"
            on_release: root.open_date_picker() if hasattr(root, 'open_date_picker') else None
        TextInput:
            id: date_input
            hint_text: "YYYY-MM-DD"
            size_hint_x: 0.2
        TextInput:
            id: amount_input
            hint_text: "Amount"
            input_filter: 'float'
            size_hint_x: 0.2
        Spinner:
            id: category_spinner
            text: "Category"
            values: root.categories
            size_hint_x: 0.25
        TextInput:
            id: note_input
            hint_text: "Note"
            size_hint_x: 0.25
        Button:
            text: "Add"
            size_hint_x: 0.1
            on_release: root.on_add()

    # Filter row
    BoxLayout:
        size_hint_y: None
        height: dp(44)
        spacing: dp(10)
        TextInput:
            id: start_date
            hint_text: "Start YYYY-MM-DD"
            size_hint_x: 0.25
        TextInput:
            id: end_date
            hint_text: "End YYYY-MM-DD"
            size_hint_x: 0.25
        Spinner:
            id: filter_category
            text: "All"
            values: ["All"] + root.categories
            size_hint_x: 0.25
        Button:
            text: "Filter"
            size_hint_x: 0.25
            on_release: root.refresh_table()

    # Action bar
    BoxLayout:
        size_hint_y: None
        height: dp(44)
        spacing: dp(10)
        Button:
            text: "Export CSV"
            on_release: root.export_csv() if hasattr(root, 'export_csv') else None
        Button:
            text: "Export Excel"
            on_release: root.export_excel() if hasattr(root, 'export_excel') else None
        Button:
            text: "Monthly Summary"
            on_release: root.show_monthly_summary()
        Button:
            text: "Category Summary"
            on_release: root.show_category_summary()

    BoxLayout:
        size_hint_y: None
        height: dp(36)
        spacing: dp(5)
        Label:
            text: "[b]ID[/b]"
            markup: True
            size_hint_x: 0.1
        Label:
            text: "[b]Date[/b]"
            markup: True
            size_hint_x: 0.2
        Label:
            text: "[b]Category[/b]"
            markup: True
            size_hint_x: 0.2
        Label:
            text: "[b]Amount[/b]"
            markup: True
            size_hint_x: 0.2
        Label:
            text: "[b]Note[/b]"
            markup: True
            size_hint_x: 0.2
        Label:
            text: "[b]Actions[/b]"
            markup: True
            size_hint_x: 0.1

    # RecycleView table
    RecycleView:
        id: rv
        viewclass: 'ExpenseRow'
        RecycleBoxLayout:
            orientation: 'vertical'
            default_size: None, dp(36)
            default_size_hint: 1, None
            size_hint_y: None
            height: self.minimum_height